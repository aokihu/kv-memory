# Changelog

## [v2.0.0] - 2026-02-14 - å®šæ—¶ç³»ç»Ÿé‡æ„ä¸ç¨³å®šæ€§æ”¹è¿›

### ğŸš€ Major Changes

#### å®šæ—¶ç³»ç»Ÿé‡æ„
- **æ ¸å¿ƒæ”¹è¿›**: å°†æ‰€æœ‰ `setInterval` ä½¿ç”¨æ›¿æ¢ä¸ºé€’å½’ `setTimeout` å®ç°
- **ä¼˜åŠ¿**: æ›´å¥½çš„å®šæ—¶æ§åˆ¶ã€é¿å…ç´¯ç§¯æ‰§è¡Œã€æ›´çµæ´»çš„é”™è¯¯å¤„ç†
- **å½±å“èŒƒå›´**: æ•°æ®åº“WALæ£€æŸ¥ç‚¹ã€è®°å¿†è¡°é€€è°ƒåº¦å™¨ã€ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

#### é”™è¯¯ä¿®å¤ä¸ç¨³å®šæ€§
- **ä¿®å¤**: `Infinity` è¶…æ—¶å‚æ•°å¯¼è‡´çš„ `TimeoutOverflowWarning` è­¦å‘Š
- **å¢å¼º**: `withTimeout` å‡½æ•°ç°åœ¨æ­£ç¡®å¤„ç†éæœ‰é™å€¼ï¼ˆInfinity, NaNï¼‰
- **æµ‹è¯•**: æ›´æ–°æ‰€æœ‰ç›¸å…³æµ‹è¯•ä»¥åŒ¹é…æ–°çš„å®šæ—¶å™¨å®ç°

#### æ¶æ„æ”¹è¿›
- **ç±»å‹å®‰å…¨**: æ›´æ–°æ‰€æœ‰å®šæ—¶å™¨ç±»å‹å®šä¹‰ï¼ˆ`ReturnType<typeof setTimeout>`ï¼‰
- **æ¸…ç†é€»è¾‘**: ç»Ÿä¸€ä½¿ç”¨ `clearTimeout` æ›¿ä»£ `clearInterval`
- **èµ„æºç®¡ç†**: æ”¹è¿›å®šæ—¶å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

### ğŸ“¦ æ–°å¢åŠŸèƒ½

#### CLIå·¥å…·å¢å¼º
- **å¤‡ä»½åŠŸèƒ½**: æ–°å¢ `kvdb-mem backup` å‘½ä»¤ï¼Œæ”¯æŒæ•°æ®åº“å®Œæ•´å¤‡ä»½
- **ä¿®å¤åŠŸèƒ½**: æ–°å¢ `kvdb-mem repair` å‘½ä»¤ï¼Œè‡ªåŠ¨ä¿®å¤FTS5ç´¢å¼•
- **æ£€æŸ¥åŠŸèƒ½**: æ–°å¢ `kvdb-mem check` å‘½ä»¤ï¼Œè¿è¡Œå¯åŠ¨æ—¶å®Œæ•´æ€§æ£€æŸ¥
- **æ„å»ºç³»ç»Ÿ**: æ–°å¢ç‹¬ç«‹äºŒè¿›åˆ¶æ„å»ºï¼Œæ”¯æŒç›´æ¥éƒ¨ç½²

#### æ–‡æ¡£å®Œå–„
- **éƒ¨ç½²æŒ‡å—**: æ–°å¢ `docs/DEPLOYMENT_GUIDE.md`
- **ç›‘æ§æŒ‡å—**: æ–°å¢ `docs/MONITORING_AND_LOGGING.md`
- **SQLiteå®‰å…¨**: æ–°å¢SQLiteå´©æºƒå®‰å…¨æ€§ç›¸å…³æ–‡æ¡£
- **CLIæ‰“åŒ…**: æ–°å¢ `docs/CLI_PACKAGING_GUIDE.md`

### ğŸ”§ æŠ€æœ¯ç»†èŠ‚

#### å®šæ—¶å™¨é‡æ„å®ç°
```typescript
// ä¹‹å‰: setInterval
walCheckpointTimer = setInterval(() => {
  performWalCheckpoint(db, databasePath, "periodic-checkpoint");
}, intervalMs);

// ä¹‹å: é€’å½’setTimeout
const scheduleNextCheckpoint = () => {
  walCheckpointTimer = setTimeout(() => {
    performWalCheckpoint(db, databasePath, "periodic-checkpoint");
    scheduleNextCheckpoint(); // é€’å½’è°ƒç”¨
  }, intervalMs);
  walCheckpointTimer.unref?.();
};
```

#### é”™è¯¯ä¿®å¤
```typescript
// ä¿®å¤Infinityè¶…æ—¶å¤„ç†
async function withTimeout<T>(promise: Promise<T>, timeoutMs: number): Promise<T> {
  if (timeoutMs <= 0 || !Number.isFinite(timeoutMs)) {
    return promise; // æ­£ç¡®å¤„ç†Infinityå’ŒNaN
  }
  // ... åŸæœ‰é€»è¾‘
}
```

### ğŸ“Š æµ‹è¯•è¦†ç›–
- **æ•°æ®åº“æµ‹è¯•**: 41ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- **è°ƒåº¦å™¨æµ‹è¯•**: 61ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡  
- **æ•´ä½“æµ‹è¯•**: 184ä¸ªæµ‹è¯•ä¸­183ä¸ªé€šè¿‡ï¼ˆ99.5%æˆåŠŸç‡ï¼‰
- **ç¼–è¯‘æ£€æŸ¥**: TypeScriptç¼–è¯‘æ— é”™è¯¯

### ğŸ¯ å‘åå…¼å®¹æ€§
- **APIå…¼å®¹**: æ‰€æœ‰HTTP APIå’ŒMCPå·¥å…·æ¥å£ä¿æŒä¸å˜
- **æ•°æ®å…¼å®¹**: æ•°æ®åº“æ¨¡å¼å’Œè¿ç§»è·¯å¾„ä¿æŒä¸å˜
- **é…ç½®å…¼å®¹**: ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶æ ¼å¼ä¿æŒä¸å˜

### ğŸ“ˆ æ€§èƒ½æ”¹è¿›
- **å®šæ—¶ç²¾åº¦**: é€’å½’setTimeoutæä¾›æ›´ç²¾ç¡®çš„å®šæ—¶æ§åˆ¶
- **èµ„æºä½¿ç”¨**: æ”¹è¿›çš„å®šæ—¶å™¨ç®¡ç†å‡å°‘å†…å­˜å ç”¨
- **é”™è¯¯æ¢å¤**: å¢å¼ºçš„é”™è¯¯å¤„ç†æé«˜ç³»ç»Ÿç¨³å®šæ€§

---

## [Unreleased] - æ‰¹é‡è¯»å–è®°å¿†åŠŸèƒ½æ”¹è¿›

### Added

#### ç‹¬ç«‹çš„æ‰¹é‡è¯»å–MCPå·¥å…·
- **æ–°å¢ç‹¬ç«‹å·¥å…·**ï¼š`bulk_read_memory`ï¼ˆsnake_caseå‘½åï¼‰
- **å·¥å…·åˆ†ç¦»**ï¼šå°†æ‰¹é‡è¯»å–åŠŸèƒ½ä»`memory_get`å·¥å…·ä¸­åˆ†ç¦»å‡ºæ¥
- **å‚æ•°ä¸€è‡´æ€§**ï¼šä½¿ç”¨`total`å‚æ•°åï¼ˆä¸HTTP APIä¿æŒä¸€è‡´ï¼‰ï¼Œè€Œé`totalLimit`
- **å®Œæ•´æµ‹è¯•**ï¼šæ–°å¢`tests/mcp.bulk-read-tools.test.ts`æµ‹è¯•æ–‡ä»¶

### Changed

#### MCPå·¥å…·æ¶æ„ä¼˜åŒ–
- **`memory_get`å·¥å…·ç®€åŒ–**ï¼šç§»é™¤æ‰¹é‡è¯»å–åŠŸèƒ½ï¼Œä¸“æ³¨äºå•å†…å­˜è¯»å–
- **å·¥å…·æ³¨å†Œæ›´æ–°**ï¼šåœ¨MCPæœåŠ¡å™¨ä¸­æ³¨å†Œç‹¬ç«‹çš„`bulk_read_memory`å·¥å…·
- **å‚æ•°æ¨¡å¼æ›´æ–°**ï¼šæ›´æ–°`MemoryGetSchema`ï¼Œç§»é™¤æ‰¹é‡è¯»å–ç›¸å…³å‚æ•°
- **æ–‡æ¡£æ›´æ–°**ï¼šæ›´æ–°æ‰€æœ‰æ–‡æ¡£ä»¥åæ˜ æ–°çš„å·¥å…·æ¶æ„

#### æ–‡æ¡£æ”¹è¿›
- **MCP-README.md**ï¼šæ·»åŠ `bulk_read_memory`å·¥å…·å®Œæ•´è¯´æ˜ï¼Œæ˜ç¡®ä¸`memory_get`çš„åŒºåˆ«
- **BULK_READ_GUIDE.md**ï¼šæ›´æ–°æ‰€æœ‰å·¥å…·å¼•ç”¨ä¸º`bulk_read_memory`ï¼Œç»Ÿä¸€å‚æ•°å‘½å
- **API.md**ï¼šæ¾„æ¸…HTTP APIä¿æŒä¸å˜ï¼ŒMCPå·¥å…·ä½œä¸ºè¡¥å……æ¥å£

### Removed

- **ä»`memory_get`ç§»é™¤**ï¼š`bulkRead`ã€`depth`ã€`breadth`ã€`total`å‚æ•°
- **ä»æµ‹è¯•ä¸­ç§»é™¤**ï¼š`memory_get`ä¸­çš„æ‰¹é‡è¯»å–ç›¸å…³æµ‹è¯•ç”¨ä¾‹

### Technical Details

- **å‘åå…¼å®¹æ€§**ï¼šHTTP APIç«¯ç‚¹`GET /api/memories/{key}/bulk`ä¿æŒä¸å˜
- **æ ¸å¿ƒç®—æ³•**ï¼šç»§ç»­ä½¿ç”¨ç°æœ‰çš„æ·±åº¦ä¼˜å…ˆéå†ç®—æ³•
- **é»˜è®¤å‚æ•°**ï¼šdepth=3, breadth=5, total=20
- **æœ€å¤§é™åˆ¶**ï¼šdepth=6, breadth=20, total=50
- **å·¥å…·å‘½å**ï¼šç»Ÿä¸€ä½¿ç”¨snake_caseå‘½åè§„èŒƒ

---

## æ‰¹é‡è¯»å–è®°å¿†åŠŸèƒ½ï¼ˆåˆå§‹å®ç°ï¼‰

### Added

#### æ‰¹é‡è¯»å–è®°å¿†åŠŸèƒ½

- **HTTP API æ”¯æŒ**:
  - æ–°å¢ `GET /api/memories/{key}/bulk` ç«¯ç‚¹
  - æ”¯æŒ `depth` (1-6)ã€`breadth` (1-20)ã€`total` (1-50) å‚æ•°é…ç½®
  - è¿”å›ç»“æ„åŒ–å“åº”ï¼ŒåŒ…å«ç›®æ ‡è®°å¿†ã€å…³è”è®°å¿†æ•°ç»„å’Œéå†å…ƒæ•°æ®
  - å®Œæ•´çš„å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†

- **MCP å·¥å…·æ‰©å±•**:
  - æ–°å¢ `memory_bulk_read` å·¥å…·
  - æ”¯æŒå®Œæ•´çš„å‚æ•°é…ç½®ï¼šdepthã€breadthã€totalLimit
  - å…¼å®¹ JSON å’Œ TOON è¾“å‡ºæ ¼å¼
  - æ”¯æŒ Session namespace è¿‡æ»¤

- **æ ¸å¿ƒç®—æ³•**:
  - æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰ç®—æ³•å®ç°
  - åŸºäº `link_weight Ã— memory_score` çš„æ™ºèƒ½æ’åº
  - åŸºäº memory key çš„å»é‡æœºåˆ¶
  - ä¸‰å±‚é™åˆ¶ä¿æŠ¤ï¼ˆæ·±åº¦ã€å¹¿åº¦ã€æ€»é‡ï¼‰
  - è¾¾åˆ°ä»»ä¸€é™åˆ¶ç«‹å³åœæ­¢éå†

- **æ–‡æ¡£æ”¯æŒ**:
  - ç”¨æˆ·æŒ‡å—ï¼š`docs/BULK_READ_GUIDE.md`
  - API æ–‡æ¡£æ›´æ–°ï¼š`API.md`
  - MCP å·¥å…·æ–‡æ¡£æ›´æ–°ï¼š`MCP-README.md`
  - å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹å’Œæ•…éšœæ’é™¤æŒ‡å—

### Changed

- æ›´æ–°äº† `API.md`ï¼Œæ·»åŠ æ‰¹é‡è¯»å–ç«¯ç‚¹è¯¦ç»†è¯´æ˜
- æ›´æ–°äº† `MCP-README.md`ï¼Œæ·»åŠ  `memory_bulk_read` å·¥å…·è¯´æ˜
- æ›´æ–°äº† `CHANGELOG.md`ï¼Œè®°å½•æ‰¹é‡è¯»å–åŠŸèƒ½å˜æ›´

### Technical Details

- **é»˜è®¤å‚æ•°**ï¼šdepth=3, breadth=5, total/totalLimit=20
- **æœ€å¤§é™åˆ¶**ï¼šdepth=6, breadth=20, total/totalLimit=50
- **æ’åºç®—æ³•**ï¼šæŒ‰ `link_weight Ã— memory_score` é™åº
- **å»é‡ç­–ç•¥**ï¼šåŸºäº memory key çš„ Set å»é‡
- **åœæ­¢æ¡ä»¶**ï¼šä»»ä¸€é™åˆ¶è¾¾åˆ°æˆ–éå†å®Œæˆ

---

## 1.0.0 - 2026-02-10

### BREAKING CHANGES

- Removed `domain` and `type` fields from memory write/update API payloads.
- Clients still sending `domain` or `type` will now fail input validation.

### Notes

- This release marks a breaking API contract change and requires client-side payload updates.
